---
import PocketBase from "pocketbase";
import DropdownCard from "./DropdownCard.astro";

const url = "https://moist-wallet.pockethost.io";
const client = new PocketBase(url);

client.autoCancellation(false);

const bars = await client.collection("Bars").getFullList({});
const barsPinted = bars.map((bar) => ({
    ...bar,
    pint: Math.floor(bar.price / bar.size / 2),
}));
const barsPintedSorted: any = [...barsPinted].sort((a, b) => a.pint - b.pint);
---

<ul class="pt-4">
    {
        barsPintedSorted.map(({ bar, price, size, updated, pint }) => (
            <li class="font-semibold mb-2 border-b-2 border-violet-300">
                <details>
                    <summary class="flex justify-between cursor-pointer">
                        <span>{bar}</span>
                        {price === pint ? (
                            <span>{price},-</span>
                        ) : (
                            <span>*{pint},-</span>
                        )}
                    </summary>
                    <DropdownCard price={price} size={size} updated={updated} />
                </details>
            </li>
        ))
    }
</ul>
